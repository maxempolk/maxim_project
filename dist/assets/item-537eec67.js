import{_ as D,r as f,o,c as n,a as t,F as m,f as g,t as r,w as b,v as k,d as w,g as h,e as u,h as v,i as C}from"./index-12e9a619.js";const T={props:{owner_id:{required:!0}},data(){return{rating:0,text:"",errors:[]}},methods:{change_rating(i){this.rating=i},send_coment(){if(this.errors=[],this.text.length==0&&this.errors.push("Text field must be not empty."),this.rating==0&&this.errors.push("Rating must be selected."),this.errors!=0)return;let i=this.$cookies.get("access_token");this.$axios.post(this.$host_adress+"/create_coment",{rating:this.rating,text:this.text,owner_id:this.owner_id},{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}).then(e=>{e.data.ok&&this.$router.push("/")})}}},U={class:"comment_block"},S={class:"errors"},B={class:"rating"};function I(i,e,l,d,c,s){const _=f("font-awesome-icon");return o(),n("div",U,[t("div",S,[t("ul",null,[(o(!0),n(m,null,g(c.errors,a=>(o(),n("li",null,r(a),1))),256))])]),b(t("textarea",{placeholder:"Enter coment text","onUpdate:modelValue":e[0]||(e[0]=a=>c.text=a),maxlength:"1000"},null,512),[[k,c.text]]),t("div",B,[(o(!0),n(m,null,g(c.rating,a=>(o(),w(_,{icon:"fa-solid fa-star",onClick:p=>s.change_rating(a)},null,8,["onClick"]))),256)),(o(!0),n(m,null,g(5-c.rating,a=>(o(),w(_,{icon:"fa-regular fa-star",onClick:p=>s.change_rating(a+c.rating)},null,8,["onClick"]))),256))]),t("a",{class:"yellow_btn",onClick:e[1]||(e[1]=(...a)=>s.send_coment&&s.send_coment(...a))},"Send comment")])}const y=D(T,[["render",I]]);const M={key:0,class:"container"},A={class:"row"},V={class:"col-10"},j={class:"row"},F={class:"col text-center"},O={class:"item_title"},E={class:"row"},N={class:"item_info"},z={class:"item_info_ul"},R={class:"row"},H={class:"col-5 image_block"},L={class:"row"},P={class:"col"},Y=["href"],Z=["src"],G=t("br",null,null,-1),J={class:"row"},K={class:"col-4"},Q=["href"],W=["src"],X={class:"col-6 right_info_block"},q={key:0,class:"row information_block"},x={class:"errors"},tt={class:"row information_block"},et={class:"row information_block"},st={class:"item_cost"},it={key:1,class:"row information_block"},ot={class:"login_url"},nt=t("span",null," to make a bid",-1),rt={key:2,class:"row information_block bid_input"},lt={class:"row"},at={class:"input-group"},_t={class:"input-group-prepend"},dt=t("span",{class:"input-group-text"},"-",-1),ct=[dt],ht=t("span",{class:"dollar-sign"},"USD",-1),ut={class:"input-group-append"},mt=t("span",{class:"input-group-text"},"+",-1),gt=[mt],pt={class:"row"},vt={class:"row description_block"},ft=t("div",{class:"row"},[t("div",{class:"title"}," Description ")],-1),wt={class:"row"},bt={class:"content"},kt={key:0,class:"row bid_history"},yt=t("hr",{class:"mt-5"},null,-1),$t=t("h3",null,"Bid History",-1),Dt={class:"table"},Ct=t("thead",null,[t("tr",null,[t("th",null,"User"),t("th",null,"Bid Amount"),t("th",null,"Time")])],-1),Tt={key:1,class:"row"},Ut=t("h3",null,"Comments",-1),St={class:"table"},Bt=t("thead",null,[t("tr",null,[t("th",null,"User"),t("th",null,"Text"),t("th",null,"Rate")])],-1),It={key:0,class:"send_comment"},Mt={class:"row justify-content-center"},At={class:"col-2 other_lots"},Vt=t("h1",null,"Other lots",-1),jt={class:"row"},Ft=["onClick"],Ot=["src"],Et={class:"cost"},Nt={key:0,class:"horisontal_line"},zt=t("div",{class:"line"},null,-1),Rt=[zt],Ht={components:{coment_sender:y},data(){return{item:null,image_now:0,bid_value:0,errors:[],bid_history:[],owner_another_lots:[],time_to_end:null,comments:null}},methods:{id_formater(i){let e=String(i),l=8-e.length;for(let d=0;d<l;d++)e="0"+e;return e},convert_data(i){return new Date(i).toISOString().slice(0,19).replace("T"," ")},async get_item(){try{let i=this.$store().getCurrentItemId();if(i==null){this.$router.push("/");return}const e=await this.$axios.post(this.$host_adress+"/get_item",{id:i});this.item=e.data.item,this.bid_value=this.item.current_price}catch(i){console.error("Error fetching item:",i)}},async get_owner(){try{if(this.$store().getCurrentItemId()==null||!this.item){this.$router.push("/");return}let l=(await this.$axios.post(this.$host_adress+"/get_user",{id:this.item.owner_id})).data.user;this.owner_another_lots=l.items}catch(i){console.error("Error fetching owner:",i)}},add_bid_value(){this.bid_value+=this.item.bid_increment},minus_bid_value(){this.bid_value-=this.item.bid_increment},do_bid(){if(this.errors=[],this.bid_value<=this.item.current_price){this.errors.push("Bid value must be bigger then current item price");return}let i=this.$cookies.get("access_token");this.$axios.post(this.$host_adress+"/do_bid",{bidder_name:this.$store().getUserInfo(),among:this.bid_value,item_id:this.item.id},{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}).then(e=>{if(e.data.ok)this.item.current_price=this.bid_value,this.owner_id=owner_id.owner_id,this.$router.push("/");else{if(e.data.is_end){this.errors.push(e.data.message);return}errors.push("The bet failed, recheck the data.")}})},next(){this.image_now+=1,this.image_now>=this.image_counts&&(this.image_now=0)},prev(){this.image_now-=1,this.image_now<0&&(this.image_now=this.image_counts-1)},formatDate(i){let e=new Date(i),l=e.getDate(),d=e.getMonth()+1,c=e.getFullYear(),s=e.getHours(),_=e.getMinutes(),a=`${l<10?"0":""}${l}.${d<10?"0":""}${d}.${c}`,p=`${s<10?"0":""}${s}:${_<10?"0":""}${_}`;return`${a}, ${p}`},daysUntilTargetDate(){if(this.item==null)return;let i=this.item.end_time,e=new Date,d=new Date(i)-e;if(d<0){this.time_to_end="The date has already passed";return}let c=Math.floor(d/(1e3*60*60*24)),s=d%(1e3*60*60*24),_=Math.floor(s/(1e3*60*60)),a=Math.floor(s%(1e3*60*60)/(1e3*60)),p=Math.floor(s%(1e3*60)/1e3),$=`${c} days ${_}:${a}:${p}`;this.time_to_end=$},async get_comments(){if(this.item==null)return;let i=this.$cookies.get("access_token");this.$axios.post(this.$host_adress+"/get_comments",{user_id:this.item.owner_id},{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}).then(e=>{this.comments=e.data})},async getData(){await this.get_item(),await this.get_owner(),await this.get_comments()}},mounted(){this.getData(),setInterval(this.daysUntilTargetDate,1e3)},computed:{image_counts(){return this.item.covers_path.split(" ").length}}},Pt=Object.assign(Ht,{__name:"item",setup(i){return(e,l)=>{const d=f("font-awesome-icon"),c=f("router-link");return e.item?(o(),n("div",M,[t("div",A,[t("div",V,[t("div",j,[t("div",F,[t("span",O,r(e.item.title),1)])]),t("div",E,[t("div",N,[t("ul",z,[t("li",null,[h(" Rates: "),t("div",null,r(e.item.rating)+" / 5",1)]),t("li",null,[h(" Current Price: "),t("div",null,r(e.item.current_price),1)]),t("li",null,[h(" Lot id: "),t("div",null,"#"+r(e.id_formater(e.item.id)),1)]),t("li",null,[h(" Added: "),t("div",null,r(e.formatDate(e.item.time_of_create)),1)]),t("li",null,[h(" Owner: "),t("div",null,r(e.item.owner_name),1)])])])]),t("div",R,[t("div",H,[t("div",L,[t("div",P,[t("a",{href:e.item.main_cover_path,target:"_blank"},[t("img",{src:e.item.main_cover_path,alt:"main_cover"},null,8,Z)],8,Y)])]),G,t("div",J,[(o(!0),n(m,null,g(e.item.covers_path.split(" ").slice(1),s=>(o(),n("div",K,[t("a",{href:s,target:"_blank"},[t("img",{src:s,alt:"secondary_cover"},null,8,W)],8,Q)]))),256))])]),t("div",X,[e.errors.length!=0?(o(),n("div",q,[t("div",x,[t("ul",null,[(o(!0),n(m,null,g(e.errors,s=>(o(),n("li",null,r(s),1))),256))])])])):u("",!0),t("div",tt,[h(" Until the end: "),t("span",null,r(e.time_to_end),1)]),t("div",et,[h(" Current price: "),t("span",st,"$"+r(e.item.current_price)+" USD",1)]),e.$cookies.get("access_token")?e.item.buyer_name!=e.$store().getUserInfo()?(o(),n("div",rt,[t("div",lt,[t("div",at,[t("div",_t,[t("a",{onClick:l[0]||(l[0]=(...s)=>e.minus_bid_value&&e.minus_bid_value(...s))},ct)]),b(t("input",{type:"number",class:"form-control","onUpdate:modelValue":l[1]||(l[1]=s=>e.bid_value=s)},null,512),[[k,e.bid_value]]),ht,t("div",ut,[t("a",{onClick:l[2]||(l[2]=(...s)=>e.add_bid_value&&e.add_bid_value(...s))},gt)])])]),t("div",pt,[t("a",{onClick:l[3]||(l[3]=(...s)=>e.do_bid&&e.do_bid(...s)),class:"do_bid_btn"},"place a bet")])])):u("",!0):(o(),n("div",it,[t("div",ot,[v(d,{icon:["fas","lock"]}),v(c,{to:"/login",class:"sign_in_text"},{default:C(()=>[h(" Sign in")]),_:1}),nt])]))])]),t("div",vt,[ft,t("div",wt,[t("div",bt,r(e.item.description),1)])]),e.item.bid_history.length!=0?(o(),n("div",kt,[yt,$t,t("table",Dt,[Ct,t("tbody",null,[(o(!0),n(m,null,g(e.item.bid_history.slice().reverse(),(s,_)=>(o(),n("tr",{key:_},[t("td",null,r(s.username),1),t("td",null,"$"+r(s.amount),1),t("td",null,r(e.formatDate(e.item.time_of_create)),1)]))),128))])])])):u("",!0),e.comments?(o(),n("div",Tt,[Ut,t("table",St,[Bt,t("tbody",null,[(o(!0),n(m,null,g(e.comments,(s,_)=>(o(),n("tr",{key:_},[t("td",null,r(s.author_name),1),t("td",null,r(s.text),1),t("td",null,r(s.rating),1)]))),128))])]),e.item.buyer_name&&e.item.buyer_name==e.$store().getUserInfo()&&e.item?(o(),n("div",It,[t("div",Mt,[v(y,{owner_id:e.item.owner_id},null,8,["owner_id"])])])):u("",!0)])):u("",!0)]),t("div",At,[Vt,e.owner_another_lots?(o(!0),n(m,{key:0},g(e.owner_another_lots.slice(0,3),(s,_)=>(o(),n("div",jt,[t("a",{onClick:a=>e.item=s},[t("img",{src:s.main_cover_path,alt:"another_cover"},null,8,Ot),t("p",null,r(s.title),1),t("p",Et," $"+r(s.current_price)+" USD ",1),_!=2?(o(),n("div",Nt,Rt)):u("",!0)],8,Ft)]))),256)):u("",!0)])])])):u("",!0)}}});export{Pt as default};
